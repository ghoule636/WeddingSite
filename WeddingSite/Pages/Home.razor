@page "/"
@inject NavigationManager Navigation

@if (selectedLanguage is null)
{
    <PageTitle>Choose Your Language</PageTitle>

    <section class="language-selector">
        <div class="language-selector__content">
            <div class="language-selector__buttons">
                <button type="button" class="language-selector__button"
                    @onclick="() => SetLanguage(LanguageHelper.English)">
                    English
                </button>
                <button type="button" class="language-selector__button"
                    @onclick="() => SetLanguage(LanguageHelper.Spanish)">
                    Espa&#241;ol
                </button>
            </div>
        </div>
    </section>
}
else
{
    <PageTitle>@CurrentContent.PageTitle</PageTitle>

    <section class="hero">
        <div class="hero__content">
            <button type="button" class="hero__language-toggle" @onclick="ResetLanguage">
                @CurrentContent.ChangeLanguageLabel
            </button>

            <p class="hero__eyebrow">@CurrentContent.Eyebrow</p>
            <h1 class="hero__date">@CurrentContent.DateLine</h1>
            <p class="hero__message">@CurrentContent.Message</p>

            <a class="btn btn-primary btn-lg hero__cta" href="@BuildRsvpLink()">
                @CurrentContent.CtaText
            </a>
        </div>
    </section>
}

@code {
    private readonly Dictionary<string, LanguageContent> contentByLanguage = new()
    {
        [LanguageHelper.English] = new LanguageContent
        {
            PageTitle = "You're Invited!",
            Eyebrow = "You're invited to our wedding!",
            DateLine = "April 18 \u00B7 Colombia",
            Message = "We can't wait to celebrate with you.",
            CtaText = "RSVP",
            ChangeLanguageLabel = "Need another language?"
        },
        [LanguageHelper.Spanish] = new LanguageContent
        {
            PageTitle = "\u00A1Est\u00E1s invitado!",
            Eyebrow = "\u00A1Est\u00E1s invitado a nuestra boda!",
            DateLine = "18 de abril \u00B7 Colombia",
            Message = "No vemos la hora de celebrar contigo.",
            CtaText = "Confirmar asistencia",
            ChangeLanguageLabel = "\u00BFNecesitas otro idioma?"
        }
    };

    private string? selectedLanguage;

    private LanguageContent CurrentContent => contentByLanguage[selectedLanguage!];

    protected override void OnParametersSet()
    {
        selectedLanguage = null;

        var languageFromUri = LanguageHelper.GetLanguageFromUri(Navigation);

        if (languageFromUri is not null &&
        contentByLanguage.ContainsKey(languageFromUri))
        {
            selectedLanguage = languageFromUri;
        }
    }

    private void SetLanguage(string language)
    {
        if (!contentByLanguage.ContainsKey(language))
        {
            return;
        }

        selectedLanguage = language;
        LanguageHelper.NavigateToCurrentWithLanguage(Navigation, language);
    }

    private void ResetLanguage()
    {
        selectedLanguage = null;
        LanguageHelper.NavigateToCurrentWithLanguage(Navigation, null);
    }

    private string BuildRsvpLink() =>
    LanguageHelper.AppendLanguageQuery("/rsvp", selectedLanguage);

    private sealed class LanguageContent
    {
        public required string PageTitle { get; init; }
        public required string Eyebrow { get; init; }
        public required string DateLine { get; init; }
        public required string Message { get; init; }
        public required string CtaText { get; init; }
        public required string ChangeLanguageLabel { get; init; }
    }
}